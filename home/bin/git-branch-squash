#!/usr/bin/env bash
set -euo pipefail

# Squash all commits in the current branch onto a base branch.

BRANCH=$(git rev-parse --abbrev-ref HEAD)
BASE=${1:-main}
MERGE_BASE=$(git merge-base HEAD "$BASE")
echo "Squashing $BRANCH onto $BASE (merge-base: $MERGE_BASE)"
git reset --soft "$MERGE_BASE" && echo "All changes staged. Commit manually with: git commit"
