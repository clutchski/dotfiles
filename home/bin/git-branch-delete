#!/usr/bin/env bash
set -euo pipefail

# Delete git branches both locally and on origin with confirmation.
# Use -f to ignore errors when remote branch doesn't exist.

force=false
yes=false
branches=()
for arg in "$@"; do
  case "$arg" in
    -f) force=true ;;
    -y) yes=true ;;
    *) branches+=("$arg") ;;
  esac
done

if [ ${#branches[@]} -eq 0 ]; then
  echo "Usage: git branch-delete [-f] [-y] <branch1> [branch2] [branch3] ..."
  exit 1
fi

if [ "$yes" = false ]; then
  echo -e "Are you sure you want to delete the following branches locally and on origin? [y/N]"
  for branch in "${branches[@]}"; do
    echo "  - ${branch}"
  done
  read -r confirm
else
  confirm=y
fi

if [[ "$confirm" =~ ^[Yy]$ ]]; then
  for branch in "${branches[@]}"; do
    echo "Deleting branch '${branch}'..."
    if git show-ref --verify --quiet "refs/heads/${branch}"; then
      git branch -D "${branch}"
    fi
    if ! git push origin --delete "${branch}" 2>/dev/null; then
      echo "Remote branch '${branch}' not found, skipping."
    fi
    echo "Branch '${branch}' deleted"
  done
else
  echo "Operation cancelled."
fi
